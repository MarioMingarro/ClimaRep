% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mh_present_future.R
\name{mh_present_future}
\alias{mh_present_future}
\title{Multivariate temporal climate representativeness analysis}
\usage{
mh_present_future(
  polygon,
  col_name,
  present_climatic_variables,
  future_climatic_variables,
  study_area,
  th = 0.9,
  model,
  year,
  dir_output = "output/",
  save_intermediate_raster = TRUE
)
}
\arguments{
\item{polygon}{An sf object containing the analysis regions (polygons).}

\item{col_name}{Character. Name of the column in the \code{polygon} object that contains unique identifiers for each polygon.}

\item{present_climatic_variables}{SpatRaster. A non correlated raster stack of climate variables representing present conditions.}

\item{future_climatic_variables}{SpatRaster. A raster stack containing the \emph{same} climate variables as \code{present_climatic_variables} but representing future projected conditions.}

\item{study_area}{sf object. A polygon defining the overall boundary of the study area. Used for clipping/masking operations.}

\item{th}{Numeric (0-1). Quantile threshold used to define representativeness. Pixels with a Mahalanobis distance below the distance corresponding to this quantile are considered representative (default: 0.95).}

\item{model}{Character. Name of the climate model used for future projections (used in output filenames).}

\item{year}{Character. Projection year for future climate data (used in output filenames).}

\item{dir_output}{Character. Path to the directory where output files will be saved. The function will create subdirectories within this path (default: "output/").}

\item{save_intermediate_raster}{Logical. If TRUE, saves intermediate rasters generated during the process (e.g., raw Mahalanobis distance). The final classification rasters listed in \verb{@return} are saved regardless of this parameter setting (default: FALSE).
Note on parameters \code{model} and \code{year}: These parameters are mandatory. They are used in the output filenames and directory structure to facilitate better data management and organization of results.}
}
\value{
Invisibly returns NULL. Writes to disk:
\itemize{
\item Classification GeoTIFF rasters (representing stable, loss, and new areas) for Present/, Future/, and Shared/ classifications in the \code{dir_output} subdirectories (saved regardless of \code{save_intermediate_raster} setting).
\item JPEG maps visualizing the classification results for each polygon in the Charts/ subdirectory within \code{dir_output}.
\item \emph{Optionally}, intermediate rasters (if \code{save_intermediate_raster = TRUE}).
}
}
\description{
Calculates Mahalanobis-based climatic representativeness for different periods of time
for polygons within a defined study area. Representativeness is assessed by comparing
climate conditions in present and future periods against a reference climate space.
The function identifies areas that remain stable, lose, or gain representativeness over time.
}
\details{
This function performs a multivariate analysis using Mahalanobis distance to assess and compare
the climatic representativeness of areas within specified polygons for present and future periods.

Key workflow steps:
\enumerate{
\item \strong{CRS Harmonization:} Ensures all spatial inputs (\code{polygon}, \code{present_climatic_variables}, \code{future_climatic_variables}, \code{study_area}) share the same Coordinate Reference System (CRS), using the CRS of \code{present_climatic_variables} as the reference.
\item \strong{Reference Climate Space:} Calculates the multivariate mean and covariance matrix based on the \code{present_climatic_variables} and \code{future_climatic_variables} within study area*. This defines the reference climate space against which representativeness is measured for each polygon.
\item \strong{Per-Polygon Processing:} For each polygon:
\itemize{
\item Clips and masks the climate rasters (\code{present_climatic_variables} and \code{future_climatic_variables}) to the polygon's extent and shape.
\item Calculates the Mahalanobis distance for \emph{each pixel} within the polygon for \emph{both} the present and future periods, using the mean and covariance matrix calculated in step 2.
\item Applies the quantile threshold (\code{th}) to the Mahalanobis distances to classify each pixel as "representative" or "not representative" for both the present and future periods within that polygon.
}
\item \strong{Classification of Change:} Based on the representativeness status in the present and future, each pixel within the polygon is classified into one of the following categories:
\itemize{
\item \strong{Stable:} Representative in both present and future periods.
\item \strong{Loss:} Representative in the present period, but not in the future.
\item \strong{New:} Not representative in the present period, but representative in the future.
\item (Optionally mention others like 'Not representative in either period' if they are explicitly handled/mapped).
}
\item \strong{Output Generation:} Generates classification rasters (merged or per-polygon) and visualization maps (JPEG) of the results for each polygon and the overall study area. Rasters are saved in GeoTIFF format and maps as JPEG files within the specified output directory structure.
}
}
\examples{
\dontrun{
library(terra)
library(sf)

# Example data paths
poly_path <- system.file("extdata", "regions.gpkg", package = "yourpackage")
present_path <- system.file("extdata", "present_climate.tif", package = "yourpackage")
future_path <- system.file("extdata", "future_climate.tif", package = "yourpackage")
study_path <- system.file("extdata", "study_area.gpkg", package = "yourpackage")

pa_mh_present_future(
polygon = st_read(poly_path),
col_name = "region_id",
present_climatic_variables = rast(present_path),
future_climatic_variables = rast(future_path),
study_area = st_read(study_path),
th = 0.85,
model = "MIROC6",
year = "2070",
dir_output = "results"
)
}

}
